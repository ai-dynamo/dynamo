# Lightweight etcd for Dynamo service discovery (failover testing)
---
apiVersion: v1
kind: Service
metadata:
  name: etcd
  namespace: default
spec:
  selector:
    app: etcd
  ports:
  - name: client
    port: 2379
    targetPort: 2379
---
apiVersion: v1
kind: Pod
metadata:
  name: etcd
  namespace: default
  labels:
    app: etcd
spec:
  containers:
  - name: etcd
    image: registry.k8s.io/etcd:3.5.17-0
    command:
    - etcd
    - --listen-client-urls=http://0.0.0.0:2379
    - --advertise-client-urls=http://etcd.default.svc.cluster.local:2379
    - --data-dir=/var/lib/etcd
    ports:
    - containerPort: 2379
    readinessProbe:
      exec:
        command: ["etcdctl", "endpoint", "health"]
      periodSeconds: 5
      failureThreshold: 3
